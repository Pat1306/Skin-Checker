<!DOCTYPE html>
<html lang="th">   
<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">  
     <title>Skin Checker</title>
     
     <style>
         body {
         
             margin: 0;
             font-family: "Segoe UI", sans-serif;
             background: #f5f7fb;
         }
         .container {
             max-width: 1100px;
             margin: auto;
             padding: 30px;
         }

         h1 {
             text-align: center;
             color: #1e88e5;
             margin-bottom: 30px;
         }

         .main{
             display:flex;
             gap:30px;
             margin-top:30px;
         }

/* ===== ‡∏ã‡πâ‡∏≤‡∏¢ ===== */
         .preview-box{
              flex:1.3;
              background:#fff;
              border-radius:16px;
              padding:20px;
              box-shadow:0 10px 30px rgba(0,0,0,0.1);
         }
         .box-title{
             color:#1e88e5;
             font-weight:bold;
             margin-bottom:10px;
         }
         .image-area{
             border:2px dashed #42a5f5;
             border-radius:12px;
             height:350px;
             display:flex;
             align-items:center;
             justify-content:center;
             position:relative;
             margin-bottom:15px;
         }
         .image-area img{
             max-width:100%;
             max-height:100%;
             object-fit:contain;
             display:none;
         }
         .image-area span{
             color:#1e88e5;
         }
         .change-btn{
             display:block;
             text-align:center;
             border:2px solid #f44336;
             color:#f44336;
             padding:10px;
             border-radius:8px;
             cursor:pointer;
             margin-bottom:15px;
  
         }
         .change-btn input{
             display:none;
         }
         .analyze-btn{
             width:100%;
             padding:14px;
             border-radius:30px;
             border:none;
             background:linear-gradient(135deg,#42a5f5,#00e5ff);
             color:#fff;
             font-size:16px;
             cursor:pointer;
         }

/* ===== ‡∏Ç‡∏ß‡∏≤ ===== */
         .result-box{
             flex:0.7;
             background:#fff;
             border-radius:16px;
             padding:20px;
             box-shadow:0 10px 30px rgba(0,0,0,0.1);
         }
             #resultTable{
             width:100%;
             border-collapse:collapse;
             display:none;
         }
        #resultTable th,#resultTable td{
              padding:8px;
              border-bottom:1px solid #ddd;
              text-align:left;
         }
         .note{
              margin-top:15px;
              color:#f44336;
             font-size:13px;
         }
         .ai-btn{
             width:100%;
             padding:14px 24px;
             border-radius:10px;
             border:none;
             font-size:16px;
             font-weight:600;
             color:#fff;
             cursor:pointer;
             background:linear-gradient(90deg,#2f6bff,#00e5ff);
             box-shadow:
                 0 4px 12px rgba(47,107,255,0.35),
                 inset 0 0 0 rgba(255,255,255,0);
             transition:all .25s ease;
         }

         .ai-btn:hover{
             transform:translateY(-1px);
             box-shadow:
                 0 8px 20px rgba(47,107,255,0.45),
                 inset 0 0 10px rgba(255,255,255,0.15);
         }

         .ai-btn:active{
             transform:scale(.98);
         }

         .ai-btn:disabled{
             background:#bdbdbd;
             box-shadow:none;
             cursor:not-allowed;
         }
         .ai-btn::after{
             content:"";
             position:absolute;
             right:0;
             top:0;
             width:40%;
             height:100%;
             background:rgba(255,255,255,0.15);
             filter:blur(10px);
         }
         /* ===== Loading Screen ===== */
         #loading{
             position:fixed;
             top:0;
             left:0;
             width:100%;
             height:100%;
             background:rgba(255,255,255,0.85);
             display:none;
             align-items:center;
             justify-content:center;
             z-index:9999;
         }

         .loading-box{
             text-align:center;
             background:#fff;
             padding:30px 40px;
             border-radius:16px;
             box-shadow:0 10px 30px rgba(0,0,0,.15);
         }

         .spinner{
             width:50px;
             height:50px;
             border:5px solid #e3f2fd;
             border-top:5px solid #1e88e5;
             border-radius:50%;
             animation:spin 1s linear infinite;
             margin:0 auto 15px;
         }
         .check-item{
             display:flex;
             align-items:center;
             gap:14px;
             padding:14px;
             margin-bottom:10px;
             background:#f5f7fb;
             border-radius:12px;
             cursor:pointer;
             font-size:16px;
         }

         .check-item:hover{
             background:#e3f2fd;
         }

         .check-item input{
             width:22px;
             height:22px;
             cursor:pointer;
         }
         .ai-btn{
  position:relative;   /* ‚≠ê ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç */
}

.ai-btn::after{
  pointer-events:none; /* ‚≠ê ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏Ñ‡∏•‡∏¥‡∏Å */
}


         @keyframes spin{
             100%{ transform:rotate(360deg); }
}


/* ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
         @media(max-width:768px){
             .main{flex-direction:column;}
         } 
</style>
</head>


<body>
    <!-- Loading Overlay -->
<div id="loading">
  <div class="loading-box">
    <div class="spinner"></div>
    <p> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...</p>
  </div>
</div>

<div class="container">
  <h1> Skin Checker</h1>

  <div class="main">

    <!-- ‡∏ã‡πâ‡∏≤‡∏¢ -->
    <div class="preview-box">
      <div class="box-title">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ</div>

      <div class="image-area">
        <img id="preview">
        <span id="previewText">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</span>
      </div>

      <label class="change-btn">
        ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ
        <input type="file" id="imageInput" accept="image/*" onchange="loadImage(event)">
      </label>

      <button class="ai-btn" onclick="predict()">Analyze</button>
    </div>

    <!-- ‡∏Ç‡∏ß‡∏≤ -->
    <div class="result-box">
      <div class="box-title">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</div>
      <div id="followUpContainer" style="display:none; margin-top:15px;">
  <h4 id="followUpTitle" style="color:#f44336;">ü©∫ ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h4>
  <div id="followUpQuestions"></div>
</div>
       <button id="riskBtn"
        class="ai-btn"
        style="display:none; margin-top:15px;"
        onclick="evaluateRisk()">
          ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á
       </button>
       <br>
         
       <div id="riskResult" style="margin-top:15px;font-weight:bold;"></div> 

      <table id="resultTable">
        <tr>
          <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
          <th>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô (%)</th>
        </tr>
      </table>

      <div class="note">
        * ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡∏ô‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÑ‡∏î‡πâ
      </div>
    </div>

  </div>
</div>


<script>
  const classToKeyMap = {
  "Actinic keratoses": "akiec",
  "Basal cell carcinoma": "bcc",
  "Benign keratosis-like lesions": "bkl",
  "Dermatofibroma": "df",
  "Melanoma": "mel",
  "Melanocytic nevi": "nv",
  "Vascular lesions": "vasc"
};

  const diseaseNameMap = {
  akiec: "Actinic keratoses",
  bcc: "Basal cell carcinoma",
  bkl: "Benign keratosis-like lesions",
  df: "Dermatofibroma",
  mel: "Melanoma",
  nv: "Melanocytic nevi",
  vasc: "Vascular lesions"
};
/* ===== 2) ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏£‡∏Ñ ===== */
const diseaseQuestions = {
  akiec: [
    "‡∏ú‡∏¥‡∏ß‡πÅ‡∏´‡πâ‡∏á ‡∏´‡∏ô‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏∏‡∏¢",
    "‡πÅ‡∏™‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏±‡∏ô",
    "‡∏ú‡∏¥‡∏ß‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ",
    "‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏ó‡∏µ‡πà‡πÇ‡∏î‡∏ô‡πÅ‡∏î‡∏î‡∏ö‡πà‡∏≠‡∏¢"
  ],
  bcc: [
    "‡∏ï‡∏∏‡πà‡∏°‡∏ô‡∏π‡∏ô‡∏°‡∏±‡∏ô‡∏ß‡∏≤‡∏ß ‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏µ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠",
    "‡πÅ‡∏ú‡∏•‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô 2‚Äì4 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå",
    "‡∏°‡∏µ‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏≠‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏∞‡πÄ‡∏Å‡πá‡∏î‡∏ã‡πâ‡∏≥",
    "‡∏°‡∏µ‡∏£‡∏≠‡∏¢‡∏ö‡∏∏‡πã‡∏°‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á"
  ],
  bkl: [
    "‡∏ú‡∏¥‡∏ß‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ï‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏ú‡∏¥‡∏ß",
    "‡∏™‡∏µ‡∏≠‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏≥",
    "‡πÑ‡∏°‡πà‡πÄ‡∏à‡πá‡∏ö ‡πÑ‡∏°‡πà‡∏Ñ‡∏±‡∏ô"
  ],
  df: [
    "‡∏Å‡πâ‡∏≠‡∏ô‡πÅ‡∏Ç‡πá‡∏á‡πÄ‡∏•‡πá‡∏Å",
    "‡∏Å‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏ö‡∏∏‡πã‡∏°"
  ],
  mel: [
    "‡πÑ‡∏ù‡πÑ‡∏°‡πà‡∏™‡∏°‡∏°‡∏≤‡∏ï‡∏£",
    "‡∏Ç‡∏≠‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö",
    "‡∏´‡∏•‡∏≤‡∏¢‡∏™‡∏µ‡πÉ‡∏ô‡∏£‡∏≠‡∏¢‡πÄ‡∏î‡∏µ‡∏¢‡∏ß",
    "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏£‡πá‡∏ß"
  ],
  nv: [
    "‡πÑ‡∏ù‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å",
    "‡∏™‡∏µ‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠",
    "‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á"
  ],
  vasc: [
    "‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏°‡πà‡∏ß‡∏á",
    "‡∏Å‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏µ‡∏à‡∏≤‡∏á"
  ]
};
function showLoading(show){
  document.getElementById("loading").style.display =
    show ? "flex" : "none";
}

function loadImage(event) {
  const img = document.getElementById("preview");
  const text = document.getElementById("previewText");
  img.src = URL.createObjectURL(event.target.files[0]);
  img.style.display = "block";
  text.style.display = "none";
}

async function predict() {
  const fileInput = document.getElementById("imageInput");
  const btn = document.querySelector(".ai-btn");
  const file = fileInput.files[0];

  if (!file) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ");
    return;
  }

  btn.disabled = true;      // üîí ‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°
  showLoading(true);        // üî• ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î

  try {
    const base64 = await toBase64(file);

    const response = await fetch(
      "https://serverless.roboflow.com/skin-b4utl/1?api_key=9j2JhaUCP9GD3ZUE5yOc",
      {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded"
        },
        body: base64
      }
    );

    const result = await response.json();
    console.log(result);

    const table = document.getElementById("resultTable");
    table.style.display = "table";
    table.innerHTML = `
      <tr>
        <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
        <th>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô (%)</th>
      </tr>
    `;

    if (!result.predictions || result.predictions.length === 0) {
      const row = table.insertRow();
      row.insertCell(0).innerText = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå";
      row.insertCell(1).innerText = "-";
    } else {
      result.predictions.forEach(p => {
        const row = table.insertRow();
        row.insertCell(0).innerText = p.class;
        row.insertCell(1).innerText =
          (p.confidence * 100).toFixed(2);
      });
    }
    const followUpContainer = document.getElementById("followUpContainer");
const followUpTitle = document.getElementById("followUpTitle");
const followUpQuestions = document.getElementById("followUpQuestions");
const riskBtn = document.getElementById("riskBtn");
const riskResult = document.getElementById("riskResult");

/* ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á */
followUpContainer.style.display = "none";
followUpQuestions.innerHTML = "";
riskBtn.style.display = "none";
riskResult.innerText = "";

if (result.predictions && result.predictions.length > 0) {

  const topPrediction = result.predictions.reduce((a, b) =>
    a.confidence > b.confidence ? a : b
  );

 const diseaseKey = classToKeyMap[topPrediction.class];   // akiec, bcc, mel ...
  const diseaseName = diseaseNameMap[diseaseKey];

  console.log("Top disease:", diseaseKey);

  if (diseaseQuestions[diseaseKey]) {

    followUpContainer.style.display = "block";
    followUpTitle.innerText =
      `ü©∫ ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (${diseaseName})`;

    diseaseQuestions[diseaseKey].forEach(q => {
      followUpQuestions.innerHTML += `
        <label class="check-item">
          <input type="checkbox">
          ${q}
        </label>
      `;
    });

    riskBtn.style.display = "block";
  }
}

  } catch (err) {
    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå");
    console.error(err);
  }

  showLoading(false);   // üî• ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î
  btn.disabled = false; // üîì ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°
}

function toBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = () =>
      resolve(reader.result.split(",")[1]);
    reader.onerror = error => reject(error);
  });
}
function evaluateRisk(){
  const checkboxes = document
    .querySelectorAll("#followUpQuestions input[type=checkbox]");
  
  let count = 0;
  checkboxes.forEach(cb => {
    if(cb.checked) count++;
  });

  const resultBox = document.getElementById("riskResult");

  if(count <= 1){
    resultBox.style.color = "green";
    resultBox.innerText =
      "üü¢ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≥ ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏ù‡πâ‡∏≤‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏≤‡∏Å‡∏≤‡∏£";
  } 
  else if(count === 2){
    resultBox.style.color = "orange";
    resultBox.innerText =
      "üü° ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏¥‡∏î";
  } 
  else{
    resultBox.style.color = "red";
    resultBox.innerText =
      "üî¥ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ú‡∏¥‡∏ß‡∏´‡∏ô‡∏±‡∏á";
  }
}
</script>
</body>
</html>